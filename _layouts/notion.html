<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} | Computer Architecture Notes</title>
    <link rel="stylesheet" href="{{ '/assets/css/notion-style.css' | relative_url }}">
    
    <!-- MathJax Configuration remains unchanged -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    
    <!-- Enhanced Syntax highlighting script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Process all code blocks
        document.querySelectorAll('pre code').forEach(function(block) {
          // Get language from class
          const langMatch = block.className.match(/language-(\w+)/);
          if (langMatch) {
            const lang = langMatch[1];
            block.parentElement.setAttribute('data-lang', lang);
            
            // Apply language-specific highlighting
            if (lang === 'python') {
              highlightPython(block);
            } else if (lang === 'cpp') {
              highlightCpp(block);
            }
          }
        });
        
        // Python syntax highlighting
        function highlightPython(block) {
          let html = block.innerHTML;
          
          // Keywords
          const keywords = ['def', 'if', 'else', 'elif', 'for', 'while', 'in', 'return', 'import', 
                           'from', 'as', 'class', 'try', 'except', 'finally', 'with', 'not', 'and', 
                           'or', 'True', 'False', 'None', 'lambda', 'global', 'nonlocal'];
          
          keywords.forEach(keyword => {
            const regex = new RegExp(`\\b${keyword}\\b`, 'g');
            html = html.replace(regex, `<span class="keyword">${keyword}</span>`);
          });
          
          // Comments
          html = html.replace(/(#.*)$/gm, '<span class="comment">$1</span>');
          
          // Strings
          html = html.replace(/(['"])(?:(?=(\\?))\2.)*?\1/g, '<span class="string">$&</span>');
          
          // Numbers
          html = html.replace(/\b(\d+(?:\.\d+)?)\b/g, '<span class="number">$1</span>');
          
          // Function definitions
          html = html.replace(/\b(def\s+)([a-zA-Z_][a-zA-Z0-9_]*)/g, '$1<span class="function">$2</span>');
          
          // Built-in functions
          const builtins = ['print', 'len', 'range', 'str', 'int', 'float', 'list', 'dict', 'set', 'tuple'];
          builtins.forEach(builtin => {
            const regex = new RegExp(`\\b(${builtin})\\b(?=\\s*\\()`, 'g');
            html = html.replace(regex, `<span class="builtin">$1</span>`);
          });
          
          block.innerHTML = html;
        }
        
        // C++ syntax highlighting
        function highlightCpp(block) {
          let html = block.innerHTML;
          
          // Keywords
          const keywords = ['if', 'else', 'for', 'while', 'do', 'switch', 'case', 'default', 
                           'break', 'continue', 'return', 'class', 'struct', 'enum', 'union', 
                           'typedef', 'static', 'const', 'public', 'private', 'protected', 
                           'new', 'delete', 'this', 'sizeof', 'true', 'false', 'nullptr'];
          
          keywords.forEach(keyword => {
            const regex = new RegExp(`\\b${keyword}\\b`, 'g');
            html = html.replace(regex, `<span class="keyword">${keyword}</span>`);
          });
          
          // Types
          const types = ['void', 'int', 'char', 'bool', 'float', 'double', 'unsigned', 'signed', 
                        'long', 'short', 'auto', 'string', 'vector', 'map', 'set'];
          
          types.forEach(type => {
            const regex = new RegExp(`\\b${type}\\b`, 'g');
            html = html.replace(regex, `<span class="type">${type}</span>`);
          });
          
          // Comments
          html = html.replace(/\/\/(.*?)$/gm, '<span class="comment">//$1</span>');
          html = html.replace(/\/\*([\s\S]*?)\*\//g, '<span class="comment">/*$1*/</span>');
          
          // Strings
          html = html.replace(/(['"])(?:(?=(\\?))\2.)*?\1/g, '<span class="string">$&</span>');
          
          // Numbers
          html = html.replace(/\b(\d+(?:\.\d+)?)\b/g, '<span class="number">$1</span>');
          
          // Preprocessor directives
          html = html.replace(/(#\w+)\b/g, '<span class="preprocessor">$1</span>');
          
          // Function definitions
          html = html.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g, '<span class="function">$1</span>(');
          
          block.innerHTML = html;
        }
      });
    </script>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Contents</h2>
            <ul class="nav-list">
                <!-- Overview Link -->
                <li class="nav-item">
                    <a href="{{ '/os/' | relative_url }}" class="overview-link">Overview</a>
                </li>

                <!-- Computer Architecture -->
                <li class="nav-item">
                    <h3>Computer Architecture</h3>
                    <ul>
                        {% assign arch_posts = site.posts | where: "categories", "computer-architecture" %}
                        {% for post in arch_posts %}
                            <li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>
                        {% endfor %}
                    </ul>
                </li>

                <!-- Operating Systems -->
                <li class="nav-item">
                    <h3>Operating Systems</h3>
                    <ul>
                        {% assign os_posts = site.posts | where: "categories", "os" %}
                        {% for post in os_posts %}
                            <li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>
                        {% endfor %}
                    </ul>
                </li>
            </ul>
        </nav>
        
        <main class="content">
            {{ content }}
        </main>
    </div>
</body>
</html>